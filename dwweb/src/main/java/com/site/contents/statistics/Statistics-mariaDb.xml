<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.site.contents.statistics.Statistics">
	<!-- 도로(국도) 리스트 조회 -->
	<select id="selectRouteList" parameterType="StatisticsVo" resultType="StatisticsVo">
		SELECT
			COUNT(POL_DISTRICT) OVER() AS TOT_CNT
			,MRI.SEQ
			,MRI.POL_CD
			,MRI.POL_DISTRICT
			,MRI.ROUTE_NM
			FROM MGMT_ROUTE_INFO MRI
		WHERE MRI.DEL_DATE IS NULL
		AND MRI.POL_CD = #{polCd}
	<if test='polDistrict != null and polDistrict != ""'>
		AND MRI.POL_DISTRICT = #{polDistrict}
	</if>
	<if test='routeCd != null and routeCd != ""'>
		AND MRI.SEQ = #{routeCd}
	</if>
		ORDER BY MRI.POL_DISTRICT ASC, MRI.ROUTE_NM ASC
	</select>
	
	<!-- 통계 조회 -->
	<select id="selectStatisticsList" parameterType="StatisticsVo" resultType="StatisticsVo">
		SELECT
			MRI.SEQ
			,MRI.ROUTE_NM
			,IFNULL(DT.CNT1,0) AS CNT1
			,IFNULL(DT.CNT2,0) AS CNT2
			,IFNULL(DT.CNT3,0) AS CNT3
			,IFNULL(DT.CNT4,0) AS CNT4
			,IFNULL(DT.CNT5,0) AS CNT5
			,IFNULL(DT.CNT6,0) AS CNT6
			,IFNULL(DT.CNT7,0) AS CNT7
			,IFNULL(DT.CNT8,0) AS CNT8
			,IFNULL(DT.CNT9,0) AS CNT9
			,IFNULL(DT.CNT10,0) AS CNT10
			,IFNULL(DT.CNT11,0) AS CNT11
			,IFNULL(DT.CNT12,0) AS CNT12
			,IFNULL(DT.CNT13,0) AS CNT13
			,IFNULL(DT.CNT14,0) AS CNT14
			,IFNULL(DT.CNT15,0) AS CNT15
			,IFNULL(DT.CNT16,0) AS CNT16
			,IFNULL(DT.CNT7,0) AS CNT17
			,IFNULL(DT.CNT18,0) AS CNT18
			,IFNULL(DT.CNT19,0) AS CNT19
			,IFNULL(DT.CNT20,0) AS CNT20
			,IFNULL(DT.CNT21,0) AS CNT21
			,IFNULL(DT.CNT22,0) AS CNT22
			,IFNULL(DT.CNT23,0) AS CNT23
			,IFNULL(DT.CNT24,0) AS CNT24
			,IFNULL(DT.CNT25,0) AS CNT25
			,IFNULL(DT.CNT26,0) AS CNT26
			,IFNULL(DT.CNT27,0) AS CNT27
			,IFNULL(DT.CNT28,0) AS CNT28
			,IFNULL(DT.CNT29,0) AS CNT29
			,IFNULL(DT.CNT30,0) AS CNT30
			,IFNULL(DT.CNT31,0) AS CNT31
			,IFNULL(DT.CNT32,0) AS CNT32
		FROM MGMT_ROUTE_INFO MRI LEFT OUTER JOIN (
				SELECT
					DT2.POL_CD
					,DT2.POL_DISTRICT
					,DT2.ROUTE_CD
					,SUM(CNT1) AS CNT1
					,SUM(CNT2) AS CNT2
					,SUM(CNT3) AS CNT3
					,SUM(CNT4) AS CNT4
					,SUM(CNT5) AS CNT5
					,SUM(CNT6) AS CNT6
					,SUM(CNT7) AS CNT7
					,SUM(CNT8) AS CNT8
					,SUM(CNT9) AS CNT9
					,SUM(CNT10) AS CNT10
					,SUM(CNT11) AS CNT11
					,SUM(CNT12) AS CNT12
					,SUM(CNT13) AS CNT13
					,SUM(CNT14) AS CNT14
					,SUM(CNT15) AS CNT15
					,SUM(CNT16) AS CNT16
					,SUM(CNT17) AS CNT17
					,SUM(CNT18) AS CNT18
					,SUM(CNT19) AS CNT19
					,SUM(CNT20) AS CNT20
					,SUM(CNT21) AS CNT21
					,SUM(CNT22) AS CNT22
					,SUM(CNT23) AS CNT23
					,SUM(CNT24) AS CNT24
					,SUM(CNT25) AS CNT25
					,SUM(CNT26) AS CNT26
					,SUM(CNT27) AS CNT27
					,SUM(CNT28) AS CNT28
					,SUM(CNT29) AS CNT29
					,SUM(CNT30) AS CNT30
					,SUM(CNT31) AS CNT31
					,SUM(CNT32) AS CNT32
				FROM(
					SELECT
						DT1.POL_CD
						,DT1.POL_DISTRICT
						,DT1.ROUTE_CD
						,CASE WHEN DT1.TYPE_CONTROLL = '1' THEN 1 ELSE 0 END AS CNT1
						,CASE WHEN DT1.TYPE_CONTROLL = '2' THEN 1 ELSE 0 END AS CNT2						
						,CASE WHEN DT1.TYPE_ROAD = '5' THEN 1 ELSE 0 END AS CNT3
						,CASE WHEN DT1.TYPE_ROAD = '6' THEN 1 ELSE 0 END AS CNT4
						,CASE WHEN DT1.SIGNAL_RULES = '1' THEN 1 ELSE 0 END AS CNT5
						,CASE WHEN DT1.SIGNAL_RULES = '2' THEN 1 ELSE 0 END AS CNT6
						,CASE WHEN DT1.SIGNAL_RULES = '3' THEN 1 ELSE 0 END AS CNT7
						,CASE WHEN DT1.SIGNAL_RULES = '4' THEN 1 ELSE 0 END AS CNT8						
						,CASE WHEN DT1.SIGNAL_WIRING = '1' THEN 1 ELSE 0 END AS CNT9
						,CASE WHEN DT1.SIGNAL_WIRING = '2' THEN 1 ELSE 0 END AS CNT10
						,CASE WHEN DT1.SIGNAL_WIRING = '3' THEN 1 ELSE 0 END AS CNT11
						,DT1.CNT12_1 + DT1.CNT12_2 + DT1.CNT12_3 + DT1.CNT12_4 AS CNT12
						,DT1.CNT13_1 + DT1.CNT13_2 + DT1.CNT13_3 + DT1.CNT13_4 AS CNT13
						,DT1.CNT14_1 + DT1.CNT14_2 + DT1.CNT14_3 AS CNT14
						,DT1.CNT15_1 + DT1.CNT15_2 + DT1.CNT15_3 AS CNT15
						,DT1.CNT16_1 + DT1.CNT16_2 + DT1.CNT16_3 AS CNT16
						,DT1.CNT17_1 + DT1.CNT17_2 + DT1.CNT17_3 AS CNT17
						,DT1.CNT18_1 + DT1.CNT18_2 + DT1.CNT18_3 AS CNT18
						,DT1.CNT19_1 + DT1.CNT19_2 + DT1.CNT19_3 AS CNT19
						,CASE WHEN DT1.UPS_TYPE = '1' THEN 1 ELSE 0 END AS CNT20
						,CASE WHEN DT1.UPS_TYPE = '2' THEN 1 ELSE 0 END AS CNT21						
						,CASE WHEN DT1.CTRL_ELECTRON = '1' THEN 1 ELSE 0 END AS CNT22
						,CASE WHEN DT1.CTRL_ELECTRON = '2' THEN 1 ELSE 0 END AS CNT23
						,CASE WHEN DT1.CTRL_ELECTRON = '3' THEN 1 ELSE 0 END AS CNT24						
						,CASE WHEN DT1.CTRL_CYCLE = '1' THEN 1 ELSE 0 END AS CNT25
						,CASE WHEN DT1.CTRL_CYCLE = '2' THEN 1 ELSE 0 END AS CNT26						
						,CASE WHEN DT1.CTRL_SENSITIVE = '1' THEN 1 ELSE 0 END AS CNT27
						,CASE WHEN DT1.CTRL_SENSITIVE = '2' THEN 1 ELSE 0 END AS CNT28
						,CASE WHEN DT1.CTRL_SENSITIVE = '3' THEN 1 ELSE 0 END AS CNT29
						,CASE WHEN DT1.CTRL_SENSITIVE = '4' THEN 1 ELSE 0 END AS CNT30
						,CASE WHEN DT1.CTRL_SENSITIVE = '5' THEN 1 ELSE 0 END AS CNT31
						,CASE WHEN DT1.CTRL_SENSITIVE = '6' THEN 1 ELSE 0 END AS CNT32
					FROM(
						SELECT
							A100.MGMT_SEQ
							,A100.POL_CD
							,A100.POL_DISTRICT
							,A100.ROUTE_CD
							,A100.ROUTE_NM
							,A100.TYPE_CONTROLL
							,A100.TYPE_ROAD
							,A200.SIGNAL_RULES
							,A200.SIGNAL_WIRING
							,A200.UPS_TYPE
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT2 = '3' THEN IFNULL(KIND_TRAFFIC_LIGHT4,0) ELSE 0 END AS CNT12_1
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT2 = '4' THEN IFNULL(KIND_TRAFFIC_LIGHT4,0) ELSE 0 END AS CNT13_1
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT6 = '3' THEN IFNULL(KIND_TRAFFIC_LIGHT8,0) ELSE 0 END AS CNT12_2
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT6 = '4' THEN IFNULL(KIND_TRAFFIC_LIGHT8,0) ELSE 0 END AS CNT13_2
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT10 = '3' THEN IFNULL(KIND_TRAFFIC_LIGHT12,0) ELSE 0 END AS CNT12_3
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT10 = '4' THEN IFNULL(KIND_TRAFFIC_LIGHT12,0) ELSE 0 END AS CNT13_3
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT14 = '3' THEN IFNULL(KIND_TRAFFIC_LIGHT16,0) ELSE 0 END AS CNT12_4
							,CASE WHEN A300.KIND_TRAFFIC_LIGHT14 = '4' THEN IFNULL(KIND_TRAFFIC_LIGHT16,0) ELSE 0 END AS CNT13_4
							,CASE WHEN A300.KIND_LAMP_WARNING2 = '2' THEN IFNULL(KIND_LAMP_WARNING4,0) ELSE 0 END AS CNT14_1
							,CASE WHEN A300.KIND_LAMP_WARNING2 = '3' THEN IFNULL(KIND_LAMP_WARNING4,0) ELSE 0 END AS CNT15_1
							,CASE WHEN A300.KIND_LAMP_WARNING6 = '2' THEN IFNULL(KIND_LAMP_WARNING8,0) ELSE 0 END AS CNT14_2
							,CASE WHEN A300.KIND_LAMP_WARNING6 = '3' THEN IFNULL(KIND_LAMP_WARNING8,0) ELSE 0 END AS CNT15_2
							,CASE WHEN A300.KIND_LAMP_WARNING10 = '2' THEN IFNULL(KIND_LAMP_WARNING12,0) ELSE 0 END AS CNT14_3
							,CASE WHEN A300.KIND_LAMP_WARNING10 = '3' THEN IFNULL(KIND_LAMP_WARNING12,0) ELSE 0 END AS CNT15_3
							,CASE WHEN A300.KIND_LAMP_VARIABLE2 = '2' THEN IFNULL(KIND_LAMP_VARIABLE4,0) ELSE 0 END AS CNT16_1
							,CASE WHEN A300.KIND_LAMP_VARIABLE2 = '3' THEN IFNULL(KIND_LAMP_VARIABLE4,0) ELSE 0 END AS CNT17_1
							,CASE WHEN A300.KIND_LAMP_VARIABLE6 = '2' THEN IFNULL(KIND_LAMP_VARIABLE8,0) ELSE 0 END AS CNT16_2
							,CASE WHEN A300.KIND_LAMP_VARIABLE6 = '3' THEN IFNULL(KIND_LAMP_VARIABLE8,0) ELSE 0 END AS CNT17_2
							,CASE WHEN A300.KIND_LAMP_VARIABLE10 = '2' THEN IFNULL(KIND_LAMP_VARIABLE12,0) ELSE 0 END AS CNT16_3
							,CASE WHEN A300.KIND_LAMP_VARIABLE10 = '3' THEN IFNULL(KIND_LAMP_VARIABLE12,0) ELSE 0 END AS CNT17_3
							,CASE WHEN A300.KIND_LAMP_WALKING2 = '2' THEN IFNULL(KIND_LAMP_WALKING4,0) ELSE 0 END AS CNT18_1
							,CASE WHEN A300.KIND_LAMP_WALKING2 = '3' THEN IFNULL(KIND_LAMP_WALKING4,0) ELSE 0 END AS CNT19_1
							,CASE WHEN A300.KIND_LAMP_WALKING6 = '2' THEN IFNULL(KIND_LAMP_WALKING8,0) ELSE 0 END AS CNT18_2
							,CASE WHEN A300.KIND_LAMP_WALKING6 = '3' THEN IFNULL(KIND_LAMP_WALKING8,0) ELSE 0 END AS CNT19_2
							,CASE WHEN A300.KIND_LAMP_WALKING10 = '2' THEN IFNULL(KIND_LAMP_WALKING12,0) ELSE 0 END AS CNT18_3
							,CASE WHEN A300.KIND_LAMP_WALKING10 = '3' THEN IFNULL(KIND_LAMP_WALKING12,0) ELSE 0 END AS CNT19_3
							,A400.CTRL_ELECTRON
							,A400.CTRL_CYCLE
							,A400.CTRL_SENSITIVE
						FROM mgmt_reg_install A100, mgmt_reg_construction A200
						,mgmt_reg_traffic_light A300, mgmt_reg_controller A400
						WHERE A100.MGMT_SEQ = A200.MGMT_SEQ
						AND A100.MGMT_SEQ = A300.MGMT_SEQ
						AND A100.MGMT_SEQ = A400.MGMT_SEQ
						AND A100.DEL_DATE IS NULL
						AND A100.ROUTE_CD IS NOT NULL
					<if test='polCd != null and polCd != ""'>
						AND A100.POL_CD = #{polCd}
					</if>
					<if test='polDistrict != null and polDistrict != ""'>						
						AND A100.POL_DISTRICT = #{polDistrict}
					</if>
					<if test='routeCd != null and routeCd != ""'>
						AND A100.ROUTE_CD = #{routeCd}
					</if>
				<if test='keyKind != null and keyKind == "installDate"'>
					<if test='stdDate != null and stdDate != ""'>
						AND A100.INSTALL_DATE <![CDATA[ >= ]]>#{stdDate}
					</if>
					<if test='endDate != null and endDate != ""'>
						AND A100.INSTALL_DATE <![CDATA[ <= ]]> #{endDate}
					</if>
				</if>
					)DT1
				)DT2
				GROUP BY DT2.POL_CD, DT2.POL_DISTRICT, DT2.ROUTE_CD
		)DT
		ON MRI.SEQ = DT.ROUTE_CD
		WHERE 1=1
	<if test='polCd != null and polCd != ""'>
		AND MRI.POL_CD = #{polCd}
	</if>
	<if test='polDistrict != null and polDistrict != ""'>
		AND MRI.POL_DISTRICT = #{polDistrict}
	</if>
	<if test='routeCd != null and routeCd != ""'>
		AND MRI.SEQ = #{routeCd}
	</if>
		ORDER BY MRI.ROUTE_NM
	</select>
	
</mapper>



